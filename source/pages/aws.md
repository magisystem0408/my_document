# aws

## マルチAZ
- 可用性
マルチAZ構成ならAZ-aのサーバに障害が起きてもAZ-cのサーバーでサービスを継続できる
- デメリット
  - コストの増加
  - 運用負荷の増加

## ec2
### インスタンスタイプ
#### m6gd.2xlarge
- インスタンスファミリー(m)
  - 価格重視、メモリ重視、CPU重視などがある
    - m バランスの取れた汎用タイプ
    - t 汎用タイプ。一時的バーストする、mより安い
    - c CPUの能力が高い
    - r メモリ強い
  - インスタンスファミリーは途中で変更可能
- CPUの種類(g)
  - i intelの　CPU基本的にはこれになる
  - a AMDベースのCPU搭載タイプ。iより約10%低コスト
  - g ARMベースのAWS Graviton2 CPU搭載タイプ。intelと比べて約45%低コスト
- 追加機能(d)
  - d 内蔵ストレージがついている。ディスクのd
  - n ネットワーク帯域幅が強化されている
### AMI
- バックアップ
- 他のアカウントへの共有
- AutoScalingの起動テンプレに使用
### ログイン
- ssh(port:22)
  - リモートのLinuxサーバーに完全に接続できるプロトコル
    - windowsだとRDP(port:3389)
### 公開鍵認証
- 公開鍵で暗号化した文章は秘密鍵でしか複合化できない
- 秘密鍵から公開鍵は生成できるが、逆は無理

### ENI(elastic network interface)
- 主に以下の情報をもつ
  - プライベートIPアドレス
  - パブリックIPアドレス
  - セキュリティグループ
- ENIは複数のIPアドレスを持つことができる

### セキュリティグループ
- ステートフル
  - 戻りの通信の考慮が不要
- NACLはステートフル

### ec2の料金体系
- オンデマンド料金
  - 1時間あたりの課金
  - 1時間未満の場合、秒単位で課金されるEC2もある
- データ転送料金(アウト)
- データ転送(イン)は料金

### EC2のバーストの仕組み
- CPUクレジットのルール
  - CPUクレジットの貯金があればバーストできる
  - CPU消費率に応じてCPUクレジットが消費される
  - Unlimitedモードの場合、CPUクレジットが枯渇すると最大24時間分のCPUクレジットを前借りして利用できる

## EBS
- EBSは、EC2にアタッチ(適応)することで使用する
- EC2:EBSは1:多の関係
  - 1つのEBSを複数のEC2にアタッチするのはNG
- EC2とEBSはAZをまたいでアタッチすることはできないが、スナップショット(別リージョンも可)をコピーして渡す
### EBSのバックアップ
- ある時点のスナップショットを取得することでバックアップ可能
- スナップショットは裏側でS3に保存されるので、RAID構成は不要
- スナップショット作成中もEBSヘのInput/Output操作は可能
- バックアップは増分バックアップ(増えた分だけバックアップ)
### ストレージのパフォーマンスを測る指標
- 容量
- スループット
  - 1secあたりのデータ転送量(MiB/秒)
- IPOS
  - EBSが1秒あたりに処理できる書き込み(input)、読み取り(output)回数
### EBSの種類
- プロビジョンドIOPSを選択するのは、常にそのIOPSパフォーマンスが必要な時だけ
- HDDタイプは起動時のボリュームとして利用不可

## Trusted Advisor
以下のカテゴリでベストプラクティスを実現するための推奨事項を提示
全ての機能を利用できるのは、ビジネスSupportプラン、エンタープライズSupportプランのみ

- コスト最適化
- パフォーマンス
- セキュリティ
- フォールトトレランス(冗長性)
- サービス制限

## compute Optimizer
Ec2やEBSが所持するスペックを効率よく使用できてるか、チェックしてくれるサービス
- EC2
  - プロビジョニング不足
  - 過剰プロビジョニング
  - 最適
- EBSやAutoScaling Group
  - 最適ではない
  - 最適
### 仕組み
裏側でCloudWatchメトリクスをモニタリングしている